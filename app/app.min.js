(function() { var debugMode = false; 
/*!
 * Betrue 2017 .
 * http://alizarion.github.io/betrued
 *
 * Betrue, v1.0.0
 * Apache 2.0 license.*/
angular.module("betrue.ar",["ngMaterial","angular-spinkit"]),angular.module("betrue.ar").controller("MainController",["$scope","$mdDialog","modeLoaderService",function(e,n,o){var t=this,a={};t.modernizr=Modernizr,e.progression=0,t.modernizr.webgl&&t.modernizr.webglextensions&&t.modernizr.getusermedia&&t.modernizr.peerconnection?o.load().then(function(e){function n(e){a=createjs.Sound.play("sound"),a.paused=!0}function o(){p.onResize(),p.copySizeTo(u.domElement),null!==m.arController&&p.copySizeTo(m.arController.canvas)}createjs.Sound.on("fileload",n),createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.registerSound({src:"assets/mp3/song52.mp3",id:"sound"});var t=[],r=new THREE.Scene,i=new THREE.Camera;r.add(i);var l=new THREE.Group;r.add(l);var c=new THREEx.ArSmoothedControls(l,{lerpPosition:.4,lerpQuaternion:.3,lerpScale:1});t.push(function(e){c.update(E)});var d=l,s=new THREE.AmbientLight(16777215,.2);d.add(s),angular.forEach(e,function(e){var n,o=e.animations,a=e.scene;if(a.rotateZ(e.config.rotateZ?e.config.rotateZ:0),a.rotateX(e.config.rotateX?e.config.rotateX:0),a.rotateZ(e.config.rotateZ?e.config.rotateZ:0),n=new THREE.AnimationMixer(a),e.config.isAnimated){n.clipAction(o[0]).play();t.push(function(){var e=clock.getDelta();void 0!==n&&n.update(e)})}a.scale.x=a.scale.y=a.scale.z=.2;var r=new THREE.DirectionalLight(16777215,.8);r.target=a,d.add(r),d.add(a)});var u=new THREE.WebGLRenderer({alpha:!0});clock=new THREE.Clock,u.setClearColor(new THREE.Color("lightgrey"),0),u.setSize(window.innerWidth,window.innerHeight),u.domElement.style.position="absolute",u.domElement.style.top="0px",u.domElement.style.left="0px";var p=new THREEx.ArToolkitSource({sourceType:"webcam"});p.init(function(){o()}),window.addEventListener("resize",function(){o()});var m=new THREEx.ArToolkitContext({cameraParametersUrl:THREEx.ArToolkitContext.baseURL+"../data/data/camera_para.dat",detectionMode:"mono",maxDetectionRate:30,canvasWidth:240,canvasHeight:180});m.init(function(){i.projectionMatrix.copy(m.getProjectionMatrix())}),t.push(function(){p.ready!==!1&&m.update(p.domElement)});var E=new THREE.Group;r.add(E);new THREEx.ArMarkerControls(m,E,{type:"pattern",patternUrl:THREEx.ArToolkitContext.baseURL+"../data/data/patt.hiro"});t.push(function(){u.render(r,i),E.visible||(a.paused=!0),E.visible&&(a.paused=!1)});var f=null;requestAnimationFrame(function g(e){requestAnimationFrame(g),f=f||e-1e3/60;var n=Math.min(200,e-f);f=e,t.forEach(function(o){o(n/1e3,e/1e3)})}),document.body.appendChild(u.domElement)},null,function(n){e.$applyAsync(function(){e.progression=n})}):n.show(n.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Oups ..").textContent("Votre navigateur n'est pas compatible avec cette animation, une application mobile sera bientot disponible").ok("Ok :("))}]),angular.module("betrue.ar").service("configService",["$http",function(e){return e({method:"GET",url:"assets/config/config.json"})}]),angular.module("betrue.ar").service("modeLoaderService",["configService","$q",function(e,n){function o(){var o=n.defer();return e.then(function(e){var n=[],t={};angular.forEach(e.data.models,function(a){t[a.url]=0;var r=new THREE.ColladaLoader;r.load(a.url,function(t){t.config=a,n.push(t),n.length==e.data.models.length&&(console.log(n),o.resolve(n))},function(n){t[a.url]=100*n.loaded/n.total;var r=0;for(var i in t)r+=t[i];console.log(r),o.notify(Math.floor(r/e.data.models.length))})})}),o.promise}return{load:o}}]);
})();